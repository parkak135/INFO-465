// productCondition.js
// Prompts user for integers until q/Q, echoes inputs, and checks if any two multiply to a third.

const readline = require("readline");

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

const numbers = [];

/**
 * Checks whether there exists a, b, c in the list such that a * b === c.
 * Returns an object describing the first match found, or null if none.
 */
function findProductCondition(nums) {
  // We can speed lookups by using a Set of values in the list.
  const values = new Set(nums);

  // Check all ordered pairs (a, b) and see if a*b exists in the list.
  // This allows cases like 3 x 9 = 27 or 9 x 3 = 27.
  for (let i = 0; i < nums.length; i++) {
    for (let j = 0; j < nums.length; j++) {
      if (i === j) continue; // "any two" -> use two different entries
      const a = nums[i];
      const b = nums[j];
      const product = a * b;

      // Need a third integer somewhere in the list equal to product.
      // Also ensure the "third integer" can be the same value as a or b only if it appears in the list;
      // since values contains it, that's fine (we're not enforcing distinct indices for c in this assignment).
      if (values.has(product)) {
        return { a, b, c: product };
      }
    }
  }

  return null;
}

/**
 * Prompts repeatedly until q/Q, collecting valid integers.
 */
function promptNext() {
  rl.question("Enter an integer (or q to quit): ", (answer) => {
    const trimmed = answer.trim();

    // Quit condition (q or Q)
    if (trimmed.toLowerCase() === "q") {
      // Echo the integers back
      if (numbers.length === 0) {
        console.log("You entered no integers.");
      } else {
        console.log("You entered:", numbers.join(", "));
      }

      // Evaluate condition
      const match = findProductCondition(numbers);

      if (match) {
        console.log(`Condition is met: ${match.a} x ${match.b} = ${match.c}`);
      } else {
        console.log("Condition was not met");
      }

      rl.close();
      return;
    }

    // Validate integer input (reject decimals and non-numeric)
    // Number.isInteger() needs a Number, so parse first.
    const parsed = Number(trimmed);

    if (!Number.isInteger(parsed)) {
      console.log("Error: Please enter an integer or 'q' to quit.");
      promptNext();
      return;
    }

    // Valid integer: store and echo immediately
    numbers.push(parsed);
    console.log(`Echo: ${parsed}`);

    promptNext();
  });
}

// Start program
console.log("Enter integers. Type 'q' (or 'Q') to quit.");
promptNext();
